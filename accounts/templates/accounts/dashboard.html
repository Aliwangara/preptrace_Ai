<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard â€¢ PrepTrace AI</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
body { font-family:'Inter',sans-serif; margin:0; background:#f4f6f8; }
header { background:#667eea; color:white; padding:18px 30px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:22px; }
header a { color:white; text-decoration:none; font-weight:500; background:#5a67d8; padding:8px 14px; border-radius:6px; font-size:14px; }
header a:hover { background:#4c51bf; }

.container { max-width:1100px; margin:25px auto; padding:0 15px; }
h2 { color:#333; margin-bottom:18px; font-size:20px; }

.ats-score-container p {
    margin: 5px 0 0;
    font-weight: 500;
    font-size: 14px;
    color: #333;
}  

/* Filter bar */
.filter-bar { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:18px; }
.filter-form input, .filter-form select, .filter-form button {
    padding:8px 12px;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:14px;
    box-shadow:0 1px 3px rgba(0,0,0,0.05);
}
.filter-form button {
    background:#667eea; color:white; border:none; cursor:pointer;
}
.filter-form button:hover { background:#5a67d8; }

/* Job cards */
.job-card { background:white; padding:18px; border-radius:12px; box-shadow:0 5px 18px rgba(0,0,0,0.06); display:flex; align-items:center; margin-bottom:15px; transition: transform 0.3s, box-shadow 0.3s; font-size:14px; }
.job-card:hover { transform: translateY(-4px); box-shadow:0 8px 25px rgba(0,0,0,0.12); }
.job-logo { width:60px; height:60px; border-radius:50%; margin-right:20px; object-fit:cover; background:#f0f0f0; display:flex; justify-content:center; align-items:center; font-weight:600; color:#555; font-size:16px; }
.fallback-logo { background:#ccc; color:white; }
.job-info h3 { margin:0 0 4px 0; font-size:16px; color:#222; }
.job-info p { margin:2px 0; color:#555; font-size:13px; }
.job-link { margin-left:auto; text-decoration:none; background:#667eea; color:white; padding:8px 12px; border-radius:8px; font-weight:500; font-size:14px; transition:0.3s; }
.job-link:hover { background:#5a67d8; }

/* Tech badges */
.tech-badges { margin-top:4px; display:flex; flex-wrap:wrap; gap:4px; }
.tech-badge { background:#e0e7ff; color:#1e40af; padding:2px 6px; border-radius:6px; font-size:11px; font-weight:500; }

/* Site badge */
.site-badge { display:inline-block; font-size:11px; padding:3px 7px; border-radius:6px; margin-top:4px; color:white; font-weight:500; }
.Remotive { background:#ff5a5f; }
.Indeed { background:#2164f3; }
.Other { background:#999; }

/* Loader */
#loader { display:none; text-align:center; margin-bottom:12px; }
#loader div { display:inline-block; width:35px; height:35px; border:4px solid #ccc; border-top-color:#667eea; border-radius:50%; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

.no-results { text-align:center; color:#555; font-style:italic; padding:22px; }

@media(max-width:600px){
    .job-card { flex-direction:column; align-items:flex-start; }
    .job-link { margin-left:0; margin-top:10px; width:100%; text-align:center; }
    .job-logo { margin-bottom:10px; }
}
</style>
</head>
<body>

<header>
    <h1>Welcome, {{ profile.user.email }}</h1>
    <a href="{% url 'logout' %}">Logout</a>
</header>

<div class="container">
    <div class="ats-score-container" style="margin-top: 10px;">
        <label>ATS Score:</label>
        <div style="background-color: #eee; border-radius: 8px; width: 100%; height: 20px;">
            <div style="width: {{ profile.ats_score }}%; height: 100%; background-color: #667eea; border-radius: 8px;"></div>
        </div>
        <p>{{ profile.ats_score }}%</p>
    </div>
    <h2>Available Jobs for {{ profile.role }}</h2>

    <!-- Filter / Search -->
    <div class="filter-bar">
        <form method="GET" class="filter-form">
            <input type="text" name="q" placeholder="Search jobs..." value="{{ request.GET.q|default:'' }}">
            <select name="site">
                <option value="">All Sites</option>
                <option value="Remotive" {% if request.GET.site == "Remotive" %}selected{% endif %}>Remotive</option>
                <option value="Indeed" {% if request.GET.site == "Indeed" %}selected{% endif %}>Indeed</option>
            </select>
            <select name="job_type">
                <option value="">All Types</option>
                <option value="full_time" {% if request.GET.job_type == "full_time" %}selected{% endif %}>Full-Time</option>
                <option value="part_time" {% if request.GET.job_type == "part_time" %}selected{% endif %}>Part-Time</option>
            </select>
        </form>
    </div>

    <!-- Loader -->
    <div id="loader"><div></div></div>

    <!-- Job Cards -->
    <div id="job-container">
        {% include 'accounts/job_cards.html' %}
    </div>
</div>

<script>
const form = document.querySelector('.filter-form');
const jobContainer = document.getElementById('job-container');
const loader = document.getElementById('loader');

let debounceTimeout;

form.addEventListener('input', function() {
    clearTimeout(debounceTimeout);
    debounceTimeout = setTimeout(() => {
        const formData = new FormData(form);
        const params = new URLSearchParams(formData);

        loader.style.display = 'block';

        fetch("{% url 'dashboard' %}?" + params.toString(), {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.json())
        .then(data => { jobContainer.innerHTML = data.html; })
        .catch(err => console.error(err))
        .finally(() => { loader.style.display = 'none'; });
    }, 300);
});
</script>

</body>
</html>
